<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolios - Ci-NDA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: #141414;
            color: white;
        }

        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 20px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            background-color: #141414;
        }

        .logo {
            font-size: 32px;
            font-weight: bold;
            color: #e50914;
            letter-spacing: 2px;
        }

        .nav-links {
            display: flex;
            gap: 25px;
            align-items: center;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #b3b3b3;
        }

        .main-content {
            padding: 100px 50px 50px;
        }

        .page-header {
            margin-bottom: 40px;
        }

        .page-header h1 {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .page-header p {
            font-size: 18px;
            color: #b3b3b3;
            max-width: 800px;
        }

        .filter-section {
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
        }

        .filter-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            background: #2a2a2a;
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .filter-btn:hover, .filter-btn.active {
            background: #e50914;
        }

        .create-portfolio-btn {
            padding: 12px 25px;
            background: #e50914;
            border: none;
            color: white;
            font-size: 14px;
            font-weight: 600;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .create-portfolio-btn:hover {
            background: #f40612;
        }

        .portfolios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 30px;
        }

        .portfolio-card {
            background: #2a2a2a;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .portfolio-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(229, 9, 20, 0.3);
        }

        .portfolio-thumbnail {
            width: 100%;
            height: 220px;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .portfolio-thumbnail::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(42, 42, 42, 0.9), transparent);
        }

        .play-icon {
            position: absolute;
            width: 60px;
            height: 60px;
            background: rgba(229, 9, 20, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 2;
        }

        .portfolio-card:hover .play-icon {
            opacity: 1;
        }

        .portfolio-content {
            padding: 20px;
        }

        .filmmaker-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .filmmaker-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            background-color: #3a3a3a;
        }

        .filmmaker-name {
            font-size: 14px;
            font-weight: 600;
        }

        .filmmaker-role {
            font-size: 12px;
            color: #999;
        }

        .portfolio-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .portfolio-description {
            font-size: 13px;
            color: #b3b3b3;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .portfolio-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .tag {
            padding: 4px 10px;
            background: #3a3a3a;
            border-radius: 12px;
            font-size: 11px;
            color: #46d369;
        }

        .portfolio-stats {
            display: flex;
            justify-content: space-between;
            padding-top: 15px;
            border-top: 1px solid #3a3a3a;
            font-size: 13px;
            color: #999;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        @media (max-width: 768px) {
            .navbar {
                padding: 20px;
            }

            .main-content {
                padding: 100px 20px 50px;
            }

            .page-header h1 {
                font-size: 32px;
            }

            .portfolios-grid {
                grid-template-columns: 1fr;
            }

            .filter-section {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
<script src="public/js/auth-utils.js"></script>
<script src="public/js/api.js"></script>
<script src="public/js/api-init.js"></script>
    <nav class="navbar">
        <div class="logo">Ci-NDA</div>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="courses.html">Courses</a>
            <a href="opportunities.html">Opportunities</a>
            <a href="mentorship.html">Mentorship</a>
            <a href="portfolios.html" style="color: #e50914;">Portfolios</a>
            
            <!-- Search functionality -->
            <div class="search-container">
                <input type="text" id="search-input" placeholder="Search portfolios...">
            </div>
        </div>

        <!-- Authentication buttons for non-logged in users -->
        <div class="auth-buttons">
            <a href="authentication.html">Sign In</a>
            <a href="authentication.html">Register</a>
        </div>

        <!-- User navigation for logged in users -->
        <div class="user-nav">
            <div class="user-avatar"></div>
            <span class="user-name">User</span>
            <a href="profile.html">Profile</a>
            <a href="#" onclick="logout()">Logout</a>
        </div>
    </nav>

    <div class="main-content">
        <div class="page-header">
            <h1>Filmmaker Portfolios</h1>
            <p>Discover talented filmmakers, watch their work, and find potential collaborators. Browse portfolios from emerging and established filmmakers worldwide.</p>
        </div>

        <div class="filter-section">
            <div class="filter-buttons">
                <button class="filter-btn active">All</button>
                <button class="filter-btn">Short Films</button>
                <button class="filter-btn">Documentaries</button>
                <button class="filter-btn">Music Videos</button>
                <button class="filter-btn">Commercials</button>
                <button class="filter-btn">Experimental</button>
            </div>
            <button class="create-portfolio-btn">+ Create Portfolio</button>
        </div>

        <div class="portfolios-grid">
            <div class="portfolio-card">
                <div class="portfolio-thumbnail" style="background-image: url('https://images.unsplash.com/photo-1478720568477-152d9b164e26?w=600&q=80');">
                    <div class="play-icon">‚ñ∂</div>
                </div>
                <div class="portfolio-content">
                    <div class="filmmaker-info">
                        <div class="filmmaker-avatar" style="background-image: url('https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&q=80');"></div>
                        <div>
                            <div class="filmmaker-name">Alex Johnson</div>
                            <div class="filmmaker-role">Director & Cinematographer</div>
                        </div>
                    </div>
                    <h3 class="portfolio-title">Urban Stories Collection</h3>
                    <p class="portfolio-description">A series of short films exploring life in modern cities through intimate character portraits and cinematic visuals.</p>
                    <div class="portfolio-tags">
                        <span class="tag">Drama</span>
                        <span class="tag">Documentary</span>
                        <span class="tag">Urban</span>
                    </div>
                    <div class="portfolio-stats">
                        <span class="stat">üëÅÔ∏è 12.5K views</span>
                        <span class="stat">‚ù§Ô∏è 892 likes</span>
                    </div>
                </div>
            </div>

            <div class="portfolio-card">
                <div class="portfolio-thumbnail" style="background-image: url('https://images.unsplash.com/photo-1492619375914-88005aa9e8fb?w=600&q=80');">
                    <div class="play-icon">‚ñ∂</div>
                </div>
                <div class="portfolio-content">
                    <div class="filmmaker-info">
                        <div class="filmmaker-avatar" style="background-image: url('https://images.unsplash.com/photo-1580489944761-15a19d654956?w=100&q=80');"></div>
                        <div>
                            <div class="filmmaker-name">Maya Patel</div>
                            <div class="filmmaker-role">Documentary Filmmaker</div>
                        </div>
                    </div>
                    <h3 class="portfolio-title">Climate Voices</h3>
                    <p class="portfolio-description">Award-winning documentary series highlighting communities affected by climate change across three continents.</p>
                    <div class="portfolio-tags">
                        <span class="tag">Documentary</span>
                        <span class="tag">Environmental</span>
                        <span class="tag">Social Impact</span>
                    </div>
                    <div class="portfolio-stats">
                        <span class="stat">üëÅÔ∏è 24.8K views</span>
                        <span class="stat">‚ù§Ô∏è 1.5K likes</span>
                    </div>
                </div>
            </div>

            <div class="portfolio-card">
                <div class="portfolio-thumbnail" style="background-image: url('https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=600&q=80');">
                    <div class="play-icon">‚ñ∂</div>
                </div>
                <div class="portfolio-content">
                    <div class="filmmaker-info">
                        <div class="filmmaker-avatar" style="background-image: url('https://images.unsplash.com/photo-1566492031773-4f4e44671857?w=100&q=80');"></div>
                        <div>
                            <div class="filmmaker-name">Carlos Mendez</div>
                            <div class="filmmaker-role">Music Video Director</div>
                        </div>
                    </div>
                    <h3 class="portfolio-title">Visual Rhythms</h3>
                    <p class="portfolio-description">Creative music videos blending experimental visuals with contemporary music across multiple genres.</p>
                    <div class="portfolio-tags">
                        <span class="tag">Music Video</span>
                        <span class="tag">Experimental</span>
                        <span class="tag">Visual Effects</span>
                    </div>
                    <div class="portfolio-stats">
                        <span class="stat">üëÅÔ∏è 18.2K views</span>
                        <span class="stat">‚ù§Ô∏è 1.1K likes</span>
                    </div>
                </div>
            </div>

            <div class="portfolio-card">
                <div class="portfolio-thumbnail" style="background-image: url('https://images.unsplash.com/photo-1524985069026-dd778a71c7b4?w=600&q=80');">
                    <div class="play-icon">‚ñ∂</div>
                </div>
                <div class="portfolio-content">
                    <div class="filmmaker-info">
                        <div class="filmmaker-avatar" style="background-image: url('https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=100&q=80');"></div>
                        <div>
                            <div class="filmmaker-name">Sophie Chen</div>
                            <div class="filmmaker-role">Commercial Director</div>
                        </div>
                    </div>
                    <h3 class="portfolio-title">Brand Stories</h3>
                    <p class="portfolio-description">High-end commercial work for global brands, focusing on emotional storytelling and stunning visuals.</p>
                    <div class="portfolio-tags">
                        <span class="tag">Commercial</span>
                        <span class="tag">Advertising</span>
                        <span class="tag">Brand</span>
                    </div>
                    <div class="portfolio-stats">
                        <span class="stat">üëÅÔ∏è 9.7K views</span>
                        <span class="stat">‚ù§Ô∏è 723 likes</span>
                    </div>
                </div>
            </div>

            <div class="portfolio-card">
                <div class="portfolio-thumbnail" style="background-image: url('https://images.unsplash.com/photo-1485846234645-a62644f84728?w=600&q=80');">
                    <div class="play-icon">‚ñ∂</div>
                </div>
                <div class="portfolio-content">
                    <div class="filmmaker-info">
                        <div class="filmmaker-avatar" style="background-image: url('https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&q=80');"></div>
                        <div>
                            <div class="filmmaker-name">David Kim</div>
                            <div class="filmmaker-role">Narrative Filmmaker</div>
                        </div>
                    </div>
                    <h3 class="portfolio-title">Human Connections</h3>
                    <p class="portfolio-description">Character-driven short films exploring themes of identity, belonging, and human relationships.</p>
                    <div class="portfolio-tags">
                        <span class="tag">Drama</span>
                        <span class="tag">Short Film</span>
                        <span class="tag">Character Study</span>
                    </div>
                    <div class="portfolio-stats">
                        <span class="stat">üëÅÔ∏è 15.3K views</span>
                        <span class="stat">‚ù§Ô∏è 967 likes</span>
                    </div>
                </div>
            </div>

            <div class="portfolio-card">
                <div class="portfolio-thumbnail" style="background-image: url('https://images.unsplash.com/photo-1440404653325-ab127d49abc1?w=600&q=80');">
                    <div class="play-icon">‚ñ∂</div>
                </div>
                <div class="portfolio-content">
                    <div class="filmmaker-info">
                        <div class="filmmaker-avatar" style="background-image: url('https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&q=80');"></div>
                        <div>
                            <div class="filmmaker-name">Lisa Anderson</div>
                            <div class="filmmaker-role">Experimental Artist</div>
                        </div>
                    </div>
                    <h3 class="portfolio-title">Abstract Narratives</h3>
                    <p class="portfolio-description">Pushing boundaries of visual storytelling through experimental techniques and abstract concepts.</p>
                    <div class="portfolio-tags">
                        <span class="tag">Experimental</span>
                        <span class="tag">Art Film</span>
                        <span class="tag">Abstract</span>
                    </div>
                    <div class="portfolio-stats">
                        <span class="stat">üëÅÔ∏è 8.1K views</span>
                        <span class="stat">‚ù§Ô∏è 612 likes</span>
                    </div>
                </div>
            </div>

            <div class="portfolio-card">
                <div class="portfolio-thumbnail" style="background-image: url('https://images.unsplash.com/photo-1460881680858-30d872d5b530?w=600&q=80');">
                    <div class="play-icon">‚ñ∂</div>
                </div>
                <div class="portfolio-content">
                    <div class="filmmaker-info">
                        <div class="filmmaker-avatar" style="background-image: url('https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&q=80');"></div>
                        <div>
                            <div class="filmmaker-name">James Wilson</div>
                            <div class="filmmaker-role">Animation Director</div>
                        </div>
                    </div>
                    <h3 class="portfolio-title">Animated Dreams</h3>
                    <p class="portfolio-description">Beautiful animated shorts combining 2D and 3D techniques to tell magical stories for all ages.</p>
                    <div class="portfolio-tags">
                        <span class="tag">Animation</span>
                        <span class="tag">Short Film</span>
                        <span class="tag">Family</span>
                    </div>
                    <div class="portfolio-stats">
                        <span class="stat">üëÅÔ∏è 21.4K views</span>
                        <span class="stat">‚ù§Ô∏è 1.8K likes</span>
                    </div>
                </div>
            </div>

            <div class="portfolio-card">
                <div class="portfolio-thumbnail" style="background-image: url('https://images.unsplash.com/photo-1579989913662-b9cd2e18dcb3?w=600&q=80');">
                    <div class="play-icon">‚ñ∂</div>
                </div>
                <div class="portfolio-content">
                    <div class="filmmaker-info">
                        <div class="filmmaker-avatar" style="background-image: url('https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&q=80');"></div>
                        <div>
                            <div class="filmmaker-name">Rachel Lee</div>
                            <div class="filmmaker-role">Cinematographer</div>
                        </div>
                    </div>
                    <h3 class="portfolio-title">Natural Light Studies</h3>
                    <p class="portfolio-description">Showcase of cinematography work focusing on natural lighting and atmospheric compositions.</p>
                    <div class="portfolio-tags">
                        <span class="tag">Cinematography</span>
                        <span class="tag">Lighting</span>
                        <span class="tag">Visual Poetry</span>
                    </div>
                    <div class="portfolio-stats">
                        <span class="stat">üëÅÔ∏è 13.9K views</span>
                        <span class="stat">‚ù§Ô∏è 1.2K likes</span>
                    </div>
                </div>
            </div>

            <div class="portfolio-card">
                <div class="portfolio-thumbnail" style="background-image: url('https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=600&q=80');">
                    <div class="play-icon">‚ñ∂</div>
                </div>
                <div class="portfolio-content">
                    <div class="filmmaker-info">
                        <div class="filmmaker-avatar" style="background-image: url('https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=100&q=80');"></div>
                        <div>
                            <div class="filmmaker-name">Marcus Brown</div>
                            <div class="filmmaker-role">Event Videographer</div>
                        </div>
                    </div>
                    <h3 class="portfolio-title">Live Moments</h3>
                    <p class="portfolio-description">Capturing the energy and emotion of live events through dynamic camera work and creative editing.</p>
                    <div class="portfolio-tags">
                        <span class="tag">Event</span>
                        <span class="tag">Live</span>
                        <span class="tag">Documentary Style</span>
                    </div>
                    <div class="portfolio-stats">
                        <span class="stat">üëÅÔ∏è 7.5K views</span>
                        <span class="stat">‚ù§Ô∏è 542 likes</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Include the API client
        const script = document.createElement('script');
        script.src = 'public/js/api.js';
        document.head.appendChild(script);

        let currentPage = 1;
        let currentCategory = 'all';
        let isLoading = false;

        // Wait for API to load
        script.onload = function() {
            document.addEventListener('DOMContentLoaded', function() {
                initializePortfolios();
                setupEventListeners();
            });
        };

        async function initializePortfolios() {
            await loadPortfolios();
            checkAuthenticationStatus();
        }

        function setupEventListeners() {
            const filterBtns = document.querySelectorAll('.filter-btn');
            const searchInput = document.getElementById('search-input');

            // Filter button event listeners
            filterBtns.forEach(btn => {
                btn.addEventListener('click', async function() {
                    if (isLoading) return;

                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    currentCategory = this.textContent.trim().toLowerCase();
                    if (currentCategory === 'all projects') currentCategory = 'all';
                    currentPage = 1;
                    
                    await loadPortfolios(true);
                });
            });

            // Search functionality
            let searchTimeout;
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(async () => {
                        currentPage = 1;
                        await loadPortfolios(true);
                    }, 500);
                });
            }

            // Add scroll listener for infinite loading
            window.addEventListener('scroll', handleScroll);
        }

        async function loadPortfolios(reset = false) {
            if (isLoading) return;
            
            isLoading = true;
            showLoading();

            try {
                const filters = {
                    page: currentPage,
                    limit: 12
                };

                // Add category filter
                if (currentCategory && currentCategory !== 'all') {
                    const categoryMap = {
                        'short films': 'Short Films',
                        'documentaries': 'Documentaries',
                        'music videos': 'Music Videos',
                        'commercials': 'Commercials',
                        'experimental': 'Experimental'
                    };
                    filters.category = categoryMap[currentCategory] || currentCategory;
                }

                // Add search filter
                const searchInput = document.getElementById('search-input');
                if (searchInput && searchInput.value.trim()) {
                    filters.search = searchInput.value.trim();
                }

                const response = await api.getPortfolios(filters);
                
                if (response.success) {
                    const portfolios = response.portfolios || [];
                    
                    if (reset) {
                        clearPortfolios();
                    }
                    
                    renderPortfolios(portfolios);
                    
                    // Update pagination info
                    if (response.pagination && response.pagination.hasNext) {
                        currentPage++;
                    }
                } else {
                    showError('Failed to load portfolios: ' + (response.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error loading portfolios:', error);
                showError('Failed to load portfolios. Please check your connection.');
            } finally {
                isLoading = false;
                hideLoading();
            }
        }

        function renderPortfolios(portfolios) {
            const container = document.querySelector('.portfolio-grid');
            
            portfolios.forEach(portfolio => {
                const portfolioCard = createPortfolioCard(portfolio);
                container.appendChild(portfolioCard);
            });
        }

        function createPortfolioCard(portfolio) {
            const card = document.createElement('div');
            card.className = 'portfolio-card';
            card.innerHTML = `
                <div class="portfolio-thumbnail" style="background-image: url('${portfolio.thumbnail || 'https://images.unsplash.com/photo-1533929736458-ca588d08c8be?w=600&q=80'}');">
                    <div class="play-icon">‚ñ∂</div>
                    <div class="portfolio-overlay">
                        <button class="like-btn ${portfolio.isLiked ? 'liked' : ''}" onclick="toggleLike(${portfolio.id})">
                            ‚ù§Ô∏è ${portfolio.likesCount || 0}
                        </button>
                        <button class="view-btn" onclick="viewPortfolio(${portfolio.id})">View Details</button>
                    </div>
                </div>
                <div class="portfolio-content">
                    <div class="filmmaker-info">
                        <div class="filmmaker-avatar" style="background-image: url('${portfolio.user?.avatar || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&q=80'}');"></div>
                        <div>
                            <div class="filmmaker-name">${portfolio.user?.name || 'Unknown'}</div>
                            <div class="filmmaker-role">Filmmaker</div>
                        </div>
                    </div>
                    <h3 class="portfolio-title">${portfolio.title}</h3>
                    <p class="portfolio-description">${portfolio.description || 'No description available'}</p>
                    <div class="portfolio-tags">
                        ${(portfolio.tags || []).map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    <div class="portfolio-stats">
                        <span class="stat">üëÅÔ∏è ${formatNumber(portfolio.views || 0)} views</span>
                        <span class="stat">‚ù§Ô∏è ${formatNumber(portfolio.likesCount || 0)} likes</span>
                        <span class="stat">üí¨ ${formatNumber(portfolio.commentsCount || 0)} comments</span>
                    </div>
                </div>
            `;
            
            // Add click event to thumbnail
            const thumbnail = card.querySelector('.portfolio-thumbnail');
            thumbnail.addEventListener('click', () => viewPortfolio(portfolio.id));
            
            return card;
        }

        async function toggleLike(portfolioId) {
            try {
                // Check if user is authenticated
                const token = localStorage.getItem('authToken');
                if (!token) {
                    alert('Please sign in to like portfolios');
                    window.location.href = 'authentication.html';
                    return;
                }

                // In a real implementation, you'd have a like endpoint
                // For now, we'll simulate the action
                const likeBtn = event.target;
                const isLiked = likeBtn.classList.contains('liked');
                
                if (isLiked) {
                    likeBtn.classList.remove('liked');
                    // Decrease count
                    const currentCount = parseInt(likeBtn.textContent.match(/\d+/)[0]);
                    likeBtn.innerHTML = `‚ù§Ô∏è ${currentCount - 1}`;
                } else {
                    likeBtn.classList.add('liked');
                    // Increase count
                    const currentCount = parseInt(likeBtn.textContent.match(/\d+/)[0]);
                    likeBtn.innerHTML = `‚ù§Ô∏è ${currentCount + 1}`;
                }
                
            } catch (error) {
                console.error('Error toggling like:', error);
                alert('Failed to toggle like');
            }
        }

        function viewPortfolio(portfolioId) {
            // Redirect to portfolio detail page or open modal
            // For now, we'll simulate opening a detail view
            window.open(`portfolio-detail.html?id=${portfolioId}`, '_blank');
        }

        function clearPortfolios() {
            const container = document.querySelector('.portfolio-grid');
            // Keep the static content for now, in a real app you'd clear everything
            const staticCards = container.querySelectorAll('.portfolio-card');
            staticCards.forEach((card, index) => {
                if (index > 5) { // Keep first 6 static cards as examples
                    card.remove();
                }
            });
        }

        function showLoading() {
            const container = document.querySelector('.portfolio-grid');
            let loader = document.getElementById('portfolio-loader');
            
            if (!loader) {
                loader = document.createElement('div');
                loader.id = 'portfolio-loader';
                loader.className = 'loading-spinner';
                loader.innerHTML = '<div class="spinner"></div><p>Loading portfolios...</p>';
                container.appendChild(loader);
            }
            
            loader.style.display = 'block';
        }

        function hideLoading() {
            const loader = document.getElementById('portfolio-loader');
            if (loader) {
                loader.style.display = 'none';
            }
        }

        function showError(message) {
            const container = document.querySelector('.portfolio-grid');
            let errorDiv = document.getElementById('portfolio-error');
            
            if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.id = 'portfolio-error';
                errorDiv.className = 'error-message';
                container.appendChild(errorDiv);
            }
            
            errorDiv.innerHTML = `
                <div class="error-content">
                    <h3>‚ö†Ô∏è Error</h3>
                    <p>${message}</p>
                    <button onclick="retryLoad()" class="retry-btn">Try Again</button>
                </div>
            `;
            errorDiv.style.display = 'block';
        }

        async function retryLoad() {
            const errorDiv = document.getElementById('portfolio-error');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
            currentPage = 1;
            await loadPortfolios(true);
        }

        function handleScroll() {
            if (isLoading) return;
            
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            
            // Load more when user is near the bottom
            if (scrollTop + windowHeight >= documentHeight - 1000) {
                loadPortfolios();
            }
        }

        function checkAuthenticationStatus() {
            const token = localStorage.getItem('authToken');
            const userNav = document.querySelector('.user-nav');
            const authButtons = document.querySelector('.auth-buttons');
            
            if (token && userNav) {
                // Show authenticated user interface
                userNav.style.display = 'block';
                if (authButtons) authButtons.style.display = 'none';
                
                // Add user info if available
                const userData = localStorage.getItem('user');
                if (userData) {
                    try {
                        const user = JSON.parse(userData);
                        const userAvatar = userNav.querySelector('.user-avatar');
                        const userName = userNav.querySelector('.user-name');
                        
                        if (userAvatar) userAvatar.style.backgroundImage = `url('${user.avatar || 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&q=80'}')`;
                        if (userName) userName.textContent = user.name || user.email;
                    } catch (e) {
                        console.error('Error parsing user data:', e);
                    }
                }
            } else {
                // Show sign in/register buttons
                if (userNav) userNav.style.display = 'none';
                if (authButtons) authButtons.style.display = 'block';
            }
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // Add create portfolio functionality
        function openCreatePortfolioModal() {
            const token = localStorage.getItem('authToken');
            if (!token) {
                alert('Please sign in to create a portfolio');
                window.location.href = 'authentication.html';
                return;
            }
            
            // Open create portfolio modal or redirect to create page
            window.location.href = 'create-portfolio.html';
        }

        // Logout functionality
        async function logout() {
            try {
                await api.logout();
                localStorage.clear();
                sessionStorage.clear();
                alert('Logged out successfully');
                window.location.reload();
            } catch (error) {
                console.error('Logout error:', error);
                // Clear local storage anyway
                localStorage.clear();
                sessionStorage.clear();
                window.location.reload();
            }
        }

        // Add this to the navbar if there's a create button
        document.addEventListener('DOMContentLoaded', function() {
            const createBtn = document.querySelector('.create-portfolio-btn');
            if (createBtn) {
                createBtn.addEventListener('click', openCreatePortfolioModal);
            }
        });
    </script>
    
    <style>
        /* Additional styles for dynamic content */
        .portfolio-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .portfolio-thumbnail:hover .portfolio-overlay {
            opacity: 1;
        }

        .like-btn, .view-btn {
            background: #e50914;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .like-btn:hover, .view-btn:hover {
            background: #b8070f;
            transform: translateY(-2px);
        }

        .like-btn.liked {
            background: #ff6b6b;
        }

        .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px;
            grid-column: 1 / -1;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #333;
            border-top: 5px solid #e50914;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
            background: #2a1a1a;
            border-radius: 8px;
            margin: 20px;
        }

        .error-content h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
        }

        .retry-btn {
            background: #e50914;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 15px;
        }

        .retry-btn:hover {
            background: #b8070f;
        }

        /* Search input styles */
        .search-container {
            position: relative;
            max-width: 400px;
        }

        #search-input {
            width: 100%;
            padding: 10px 15px;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 25px;
            color: white;
            font-size: 14px;
        }

        #search-input:focus {
            outline: none;
            border-color: #e50914;
        }

        #search-input::placeholder {
            color: #888;
        }

        /* User navigation */
        .user-nav {
            display: none;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
        }

        .auth-buttons a {
            padding: 8px 16px;
            background: #e50914;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .auth-buttons a:hover {
            background: #b8070f;
        }
    </style>
</body>
</html>